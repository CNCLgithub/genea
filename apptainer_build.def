bootstrap:docker
From: nvidia/cudagl:11.4.2-devel-ubuntu20.04


%environment
export DEBIAN_FRONTEND=noninteractive
export PATH=/opt/openrobots/bin:$PATH
export PKG_CONFIG_PATH=/opt/openrobots/lib/pkgconfig:$PKG_CONFIG_PATH
export LD_LIBRARY_PATH=/opt/openrobots/lib:$LD_LIBRARY_PATH
export PYTHONPATH=/opt/openrobots/lib/python3.8/site-packages:$PYTHONPATH
export CMAKE_PREFIX_PATH=/opt/openrobots:$CMAKE_PREFIX_PATH


%runscript
exec bash "$*"


%post
# Set up some required environment defaults
export DEBIAN_FRONTEND=noninteractive
apt-get update -y
apt-get -y install build-essential
apt-get -y --force-yes install vim
apt-get -y update
apt-get -y install wget \
                   dpkg \
                   cmake  \
                   git  \
                   curl \
                   gdb \
                   libgtk2.0-dev  \
                   pkg-config  \
                   libavcodec-dev  \
                   libavformat-dev  \
                   libswscale-dev  \
                   gnuplot  \
                   liblapack-dev  \
                   libf2c2-dev  \
                   coreutils  \
                   libglew-dev  \
                   libann-dev  \
                   libqhull-dev  \
                   libx11-dev  \
                   libxi-dev  \
                   libxmu-dev  \
                   libgraphviz-dev  \
                   unzip \
                   libgl1-mesa-dri \
                   libstdc++6 \
                   libglu1-mesa \
                   libglu1-mesa-dev \
                   mesa-utils \
                   libgl1-mesa-glx \
                   freeglut3 \
                   freeglut3-dev \
                   python3.8 \
                   python3.8-venv \
                   python3-dev \
                   libpython3.8-dev \
                   glew-utils \
                   libeigen3-dev

apt-get clean

# sort out the libGLEW issue for Ubuntu 20.04
ln -f -s /usr/lib/x86_64-linux-gnu/libGLEW.so.2.1 /usr/lib/libGLEW.so.1.13

update-alternatives --install /usr/bin/python python /usr/bin/python3.8 1


# Some update and cleanup
apt-get -y upgrade
apt-get clean


# For Pinocchio
mkdir -p /etc/apt/keyrings

curl http://robotpkg.openrobots.org/packages/debian/robotpkg.asc | tee /etc/apt/keyrings/robotpkg.asc
echo "deb [arch=amd64 signed-by=/etc/apt/keyrings/robotpkg.asc] http://robotpkg.openrobots.org/packages/debian/pub $(lsb_release -cs) robotpkg" | tee /etc/apt/sources.list.d/robotpkg.list

apt-get update

apt install -qqy robotpkg-py3*-pinocchio
apt install robotpkg-py38-qt5-gepetto-viewer-corba -y
